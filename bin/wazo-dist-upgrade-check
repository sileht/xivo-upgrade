#!/usr/bin/env python3
# Copyright 2018 The Wazo Authors  (see the AUTHORS file)
# SPDX-License-Identifier: GPL-3.0+

import sys


class WazoDistUpgradeException(Exception):
    pass


class WrongWazoVersion(WazoDistUpgradeException):

    _message = 'wazo-dist-upgrade should not be run on Wazo {}. You should run wazo-upgrade instead.'

    def __init__(self, wazo_version):
        super().__init__(self._message.format(wazo_version))


def main():
    try:
        check_wazo_version()
    except WazoDistUpgradeException as e:
        print(e, file=sys.stderr)
        sys.exit(1)


def check_wazo_version():
    print(installed_wazo_version())
    if installed_wazo_version() not in ('17.17', '18.01'):
        raise WrongWazoVersion(installed_wazo_version())


def installed_wazo_version():
    with open('/usr/share/xivo/XIVO-VERSION', 'r') as version_file:
        return str(version_file.read()).strip()


if __name__ == '__main__':
    main()
